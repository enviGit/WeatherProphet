<Window x:Class="WeatherProphet.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:WeatherProphet.ViewModels"
        mc:Ignorable="d"
        Title="{Binding AppTitle}" 
        Height="650" Width="1100" 
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        WindowStartupLocation="CenterOwner">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" 
                      ResizeBorderThickness="5" 
                      CornerRadius="10" 
                      GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Themes/DarkTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        </ResourceDictionary>
    </Window.Resources>

    <Border Background="{DynamicResource BackgroundBrush}" 
            CornerRadius="10" 
            BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}">
        <Border.Effect>
            <DropShadowEffect Color="Black" BlurRadius="20" ShadowDepth="5" Opacity="0.4"/>
        </Border.Effect>

        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,20" Background="Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Border Grid.ColumnSpan="5" Background="Transparent" MouseLeftButtonDown="Window_MouseDown"/>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" IsHitTestVisible="False" Grid.Column="0">
                    <Image Source="Icons/weather.png" Width="24" Height="24" Margin="0,0,10,0"/>
                    <TextBlock Text="{Binding AppTitle}" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
                </StackPanel>

                <ComboBox Grid.Column="2" Width="160" Margin="0,0,10,0"
                          ItemsSource="{Binding AvailableLanguages}"
                          SelectedItem="{Binding SelectedLanguage, Mode=TwoWay}"
                          WindowChrome.IsHitTestVisibleInChrome="True">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Image Width="20" Height="16" Margin="0,0,10,0" Source="{Binding FlagIcon}" RenderOptions.BitmapScalingMode="HighQuality"/>
                                <TextBlock Text="{Binding DisplayName}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <Button Grid.Column="3" Click="Button_ToggleTheme"
                        Width="35" Height="35" Margin="0,0,5,0"
                        Background="Transparent"
                        ToolTip="Change Theme"
                        WindowChrome.IsHitTestVisibleInChrome="True">
                    <Path Data="{DynamicResource ThemeIconGeometry}" 
                          Fill="{DynamicResource ForegroundBrush}" 
                          Stretch="Uniform" 
                          Width="18" Height="18"
                          RenderTransformOrigin="0.5,0.5">
                        <Path.RenderTransform>
                            <RotateTransform Angle="0"/>
                        </Path.RenderTransform>
                        <Path.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(RotateTransform.Angle)" 
                                                         From="0" To="360" Duration="0:0:1" 
                                                         FillBehavior="Stop"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Path.Triggers>
                    </Path>
                </Button>

                <StackPanel Grid.Column="4" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button Content="-" Click="Minimize_Click" Width="35" Height="35" Margin="0,0,5,0" Background="Transparent" Foreground="{DynamicResource ForegroundBrush}" FontSize="18"/>
                    <Button Content="✕" Click="Close_Click" Width="35" Height="35" Background="Transparent" Foreground="#FF5555" FontSize="14" FontWeight="Bold"/>
                </StackPanel>
            </Grid>

            <Border Grid.Row="1" Background="{DynamicResource ControlLightBrush}" 
        Opacity="0.05" CornerRadius="10" Margin="-10" Panel.ZIndex="-1"/>

            <Grid Grid.Row="1" Margin="0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                    <TextBlock Text="{Binding CityLabel}" FontWeight="SemiBold" Margin="0,0,0,5" Opacity="0.7"/>
                    <TextBox Text="{Binding CityName, UpdateSourceTrigger=PropertyChanged}" Height="40" FontSize="16" VerticalContentAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="10,0,10,0">
                    <TextBlock Text="{Binding ForecastsLabel}" FontWeight="SemiBold" Margin="0,0,0,5" Opacity="0.7"/>
                    <ComboBox ItemsSource="{Binding DaysOptions}" 
                              SelectedItem="{Binding SelectedDays}"
                              Height="40" VerticalContentAlignment="Center" FontSize="16"/>
                </StackPanel>

                <Button Grid.Column="2" 
                        Command="{Binding GetWeatherCommand}"
                        Content="{Binding ButtonLabel}"
                        Height="40" Width="120"
                        VerticalAlignment="Bottom"
                        FontWeight="Bold" Cursor="Hand"/>
            </Grid>

            <ProgressBar Grid.Row="2" IsIndeterminate="True" Height="4" 
                         Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" 
                         Margin="0,15,0,0" Foreground="{DynamicResource AccentBrush}" Background="Transparent" BorderThickness="0"/>

            <TextBlock Grid.Row="2" Text="{Binding ErrorMessage}" 
                       Foreground="#FF5555" FontWeight="Bold" HorizontalAlignment="Center"
                       Visibility="{Binding HasError, Converter={StaticResource BoolToVis}}"
                       Margin="0,15,0,0"/>

            <Border Grid.Row="2" Margin="0,20" 
                    Padding="0" CornerRadius="20"
                    Background="{DynamicResource SurfaceBrush}"
                    
                    Visibility="{Binding IsWeatherLoaded, Converter={StaticResource BoolToVis}, FallbackValue=Collapsed}">
                <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="3" Opacity="0.2"/>
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="30,30,30,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Image Source="{Binding CurrentWeather.ImageUrl}" Width="90" Height="90" Grid.Column="0" Margin="0,0,20,0">
                            <Image.Effect>
                                <DropShadowEffect Color="{DynamicResource AccentBrushColor}" BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                            </Image.Effect>
                        </Image>

                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{Binding CityName}" FontSize="28" FontWeight="Bold"/>
                            <TextBlock Text="{Binding CurrentWeather.Weather}" FontSize="16" Opacity="0.7"/>
                            <TextBlock Text="{Binding CurrentWeather.FormattedDate}" FontSize="12" Opacity="0.5" Margin="0,5,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right">
                            <TextBlock Text="{Binding CurrentWeather.Temperature, StringFormat='{}{0:F0}°'}" 
                                   FontSize="64" FontWeight="Light" 
                                   Foreground="{DynamicResource AccentBrush}" 
                                   HorizontalAlignment="Right" LineHeight="60"/>
                            <TextBlock Text="{Binding CurrentWeather.FeelsLike, StringFormat='Feels like {0:F0}°'}" 
                                   FontSize="12" Opacity="0.6" 
                                   HorizontalAlignment="Right" Margin="0,-5,0,0"/>
                        </StackPanel>
                    </Grid>

                    <Border Grid.Row="1" Background="{DynamicResource AccentBrush}" Opacity="0.08" CornerRadius="0,0,20,20" Height="70"/>

                    <Grid Grid.Row="1" Height="70">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="💧" FontSize="18" HorizontalAlignment="Center" Margin="0,0,0,2"/>
                            <TextBlock Text="{Binding CurrentWeather.Humidity, StringFormat='{}{0}%'}" FontWeight="Bold" HorizontalAlignment="Center"/>
                            <TextBlock Text="Humidity" FontSize="10" Opacity="0.5" HorizontalAlignment="Center"/>
                        </StackPanel>

                        <Rectangle Grid.Column="1" Width="1" Fill="{DynamicResource ForegroundBrush}" Opacity="0.1" Margin="0,15"/>

                        <StackPanel Grid.Column="2" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="💨" FontSize="18" HorizontalAlignment="Center" Margin="0,0,0,2"/>
                            <TextBlock Text="{Binding CurrentWeather.WindSpeed, StringFormat='{}{0:F1} m/s'}" FontWeight="Bold" HorizontalAlignment="Center"/>
                            <TextBlock Text="Wind" FontSize="10" Opacity="0.5" HorizontalAlignment="Center"/>
                        </StackPanel>

                        <Rectangle Grid.Column="3" Width="1" Fill="{DynamicResource ForegroundBrush}" Opacity="0.1" Margin="0,15"/>

                        <StackPanel Grid.Column="4" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="⏲" FontSize="18" HorizontalAlignment="Center" Margin="0,0,0,2"/>
                            <TextBlock Text="{Binding CurrentWeather.Pressure, StringFormat='{}{0} hPa'}" FontWeight="Bold" HorizontalAlignment="Center"/>
                            <TextBlock Text="Pressure" FontSize="10" Opacity="0.5" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ListBox ItemsSource="{Binding Forecasts}" 
                         BorderThickness="0" Background="Transparent"
                         HorizontalContentAlignment="Stretch"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">

                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel HorizontalAlignment="Center"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Width="160" Margin="5">
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding DayOfWeek}" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding FormattedDate}" FontSize="12" Opacity="0.5" HorizontalAlignment="Center" Margin="0,0,0,10"/>

                                    <Image Source="{Binding ImageUrl}" Width="60" Height="60" Margin="0,0,0,5"/>

                                    <TextBlock Text="{Binding Temperature, StringFormat='{}{0:F1}°'}" 
                                               FontSize="24" FontWeight="Bold" 
                                               Foreground="{DynamicResource AccentBrush}"
                                               HorizontalAlignment="Center"/>

                                    <TextBlock Text="{Binding Weather}" TextWrapping="Wrap" TextAlignment="Center" FontSize="12" Opacity="0.8" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>

        </Grid>
    </Border>
</Window>